@page "/"
@using Microsoft.AspNetCore.Components.Web
@namespace SchedulerMVP.Pages
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SchedulerMVP</title>
    <base href="~/" />
    <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="css/site.css" />
    <link rel="stylesheet" href="css/global.css" />
    <link rel="stylesheet" href="css/login.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,300..700,0..1,-50..200" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <component type="typeof(HeadOutlet)" render-mode="ServerPrerendered" />
</head>
<body>
    <component type="typeof(SchedulerMVP.Components.App)" render-mode="Server" />

    

    <script src="js/dragdrop.js"></script>
    <script src="js/blazor-connection.js"></script>
    <script src="_framework/blazor.server.js"></script>
    <script>
        // Ensure Blazor is loaded before initializing connection monitoring
        window.addEventListener('load', function() {
            console.log('[Blazor] Window loaded, checking Blazor...');
            
            // Wait for Blazor to be available
            const checkBlazor = setInterval(function() {
                if (window.Blazor) {
                    clearInterval(checkBlazor);
                    console.log('[Blazor] Blazor framework detected');
                    
                    // Monitor for connection issues
                    const originalStart = Blazor.start;
                    Blazor.start = function() {
                        console.log('[Blazor] Starting Blazor Server...');
                        const result = originalStart.apply(this, arguments);
                        
                        // Log connection status
                        setTimeout(function() {
                            console.log('[Blazor] Blazor Server started, connection should be active');
                            if (window.blazorConnection) {
                                window.blazorConnection.connectionState = 'Connected';
                            }
                        }, 500);
                        
                        return result;
                    };
                }
            }, 100);
            
            // Timeout after 5 seconds
            setTimeout(function() {
                if (!window.Blazor) {
                    clearInterval(checkBlazor);
                    console.error('[Blazor] ERROR: Blazor not loaded after 5 seconds!');
                    if (window.blazorConnection) {
                        window.blazorConnection.showConnectionError('Blazor kunde inte laddas. Kontrollera konsolen f√∂r detaljer.');
                    }
                }
            }, 5000);
            
            // Attach direct JavaScript click handler to test button as fallback
            setTimeout(function() {
                const testBtn = document.getElementById('test-button-debug');
                if (testBtn) {
                    console.log('[DEBUG] Test button found in DOM, attaching JavaScript handler');
                    testBtn.addEventListener('click', function(e) {
                        console.log('[DEBUG] Test button clicked - JavaScript event handler fired!');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // Show modal directly via JavaScript (Blazor handlers may not work)
                        console.log('[DEBUG] Attempting to show modal via JavaScript');
                        const modal = document.getElementById('test-modal');
                        const overlay = document.getElementById('test-modal-overlay');
                        if (modal && overlay) {
                            modal.style.display = 'block';
                            overlay.style.display = 'block';
                            console.log('[DEBUG] Modal shown via JavaScript');
                            
                            // Attach close handler
                            const closeBtn = modal.querySelector('button');
                            const closeHandler = function() {
                                modal.style.display = 'none';
                                overlay.style.display = 'none';
                                console.log('[DEBUG] Modal closed via JavaScript');
                            };
                            overlay.onclick = closeHandler;
                            if (closeBtn) {
                                closeBtn.onclick = closeHandler;
                            }
                        } else {
                            alert('TEST BUTTON CLICKED - JavaScript handler works! But modal elements not found.');
                        }
                        return false;
                    });
                } else {
                    console.error('[DEBUG] Test button NOT found in DOM after 2 seconds');
                }
            }, 2000);
        });
    </script>
</body>
</html>

