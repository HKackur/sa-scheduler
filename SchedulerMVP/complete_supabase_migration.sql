-- Complete migration to Supabase
-- Run this in your Supabase SQL editor

-- Create tables
CREATE TABLE IF NOT EXISTS "Groups" (
    "Id" TEXT NOT NULL PRIMARY KEY,
    "Name" TEXT NOT NULL,
    "ColorHex" TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS "Places" (
    "Id" TEXT NOT NULL PRIMARY KEY,
    "Name" TEXT NOT NULL,
    "DefaultDurationMin" INTEGER NOT NULL,
    "SnapMin" INTEGER NOT NULL,
    "VisibleStartMin" INTEGER NOT NULL,
    "VisibleEndMin" INTEGER NOT NULL
);

CREATE TABLE IF NOT EXISTS "Areas" (
    "Id" TEXT NOT NULL PRIMARY KEY,
    "PlaceId" TEXT NOT NULL,
    "Name" TEXT NOT NULL,
    "ParentAreaId" TEXT NULL,
    "Path" TEXT NOT NULL,
    "Level1WidthPercent" INTEGER NOT NULL DEFAULT 0,
    "Level2WidthPercent" INTEGER NOT NULL DEFAULT 0,
    "Level3WidthPercent" INTEGER NOT NULL DEFAULT 0,
    FOREIGN KEY ("ParentAreaId") REFERENCES "Areas" ("Id") ON DELETE RESTRICT,
    FOREIGN KEY ("PlaceId") REFERENCES "Places" ("Id") ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS "Leafs" (
    "Id" TEXT NOT NULL PRIMARY KEY,
    "PlaceId" TEXT NOT NULL,
    "Name" TEXT NOT NULL,
    "SortOrder" INTEGER NOT NULL,
    FOREIGN KEY ("PlaceId") REFERENCES "Places" ("Id") ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS "ScheduleTemplates" (
    "Id" TEXT NOT NULL PRIMARY KEY,
    "Name" TEXT NOT NULL,
    "PlaceId" TEXT NOT NULL,
    FOREIGN KEY ("PlaceId") REFERENCES "Places" ("Id") ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS "AreaLeafs" (
    "AreaId" TEXT NOT NULL,
    "LeafId" TEXT NOT NULL,
    PRIMARY KEY ("AreaId", "LeafId"),
    FOREIGN KEY ("AreaId") REFERENCES "Areas" ("Id") ON DELETE CASCADE,
    FOREIGN KEY ("LeafId") REFERENCES "Leafs" ("Id") ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS "BookingTemplates" (
    "Id" TEXT NOT NULL PRIMARY KEY,
    "ScheduleTemplateId" TEXT NOT NULL,
    "AreaId" TEXT NOT NULL,
    "GroupId" TEXT NOT NULL,
    "DayOfWeek" INTEGER NOT NULL,
    "StartMin" INTEGER NOT NULL,
    "EndMin" INTEGER NOT NULL,
    "Notes" TEXT NULL,
    FOREIGN KEY ("AreaId") REFERENCES "Areas" ("Id") ON DELETE CASCADE,
    FOREIGN KEY ("GroupId") REFERENCES "Groups" ("Id") ON DELETE CASCADE,
    FOREIGN KEY ("ScheduleTemplateId") REFERENCES "ScheduleTemplates" ("Id") ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS "Bookings" (
    "Id" TEXT NOT NULL PRIMARY KEY,
    "AreaId" TEXT NOT NULL,
    "GroupId" TEXT NOT NULL,
    "Date" TEXT NOT NULL,
    "StartMin" INTEGER NOT NULL,
    "EndMin" INTEGER NOT NULL,
    "Notes" TEXT NULL,
    "CreatedAt" TEXT NOT NULL,
    FOREIGN KEY ("AreaId") REFERENCES "Areas" ("Id") ON DELETE CASCADE,
    FOREIGN KEY ("GroupId") REFERENCES "Groups" ("Id") ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS "CalendarBookings" (
    "Id" TEXT NOT NULL PRIMARY KEY,
    "AreaId" TEXT NOT NULL,
    "GroupId" TEXT NOT NULL,
    "Date" TEXT NOT NULL,
    "StartMin" INTEGER NOT NULL,
    "EndMin" INTEGER NOT NULL,
    "Notes" TEXT NULL,
    "SourceTemplateId" TEXT NULL,
    FOREIGN KEY ("AreaId") REFERENCES "Areas" ("Id") ON DELETE CASCADE,
    FOREIGN KEY ("SourceTemplateId") REFERENCES "BookingTemplates" ("Id"),
    FOREIGN KEY ("GroupId") REFERENCES "Groups" ("Id") ON DELETE CASCADE
);

-- Create indexes
CREATE INDEX "IX_AreaLeafs_AreaId" ON "AreaLeafs" ("AreaId");
CREATE INDEX "IX_AreaLeafs_LeafId" ON "AreaLeafs" ("LeafId");
CREATE INDEX "IX_Areas_ParentAreaId" ON "Areas" ("ParentAreaId");
CREATE INDEX "IX_Areas_Path" ON "Areas" ("Path");
CREATE INDEX "IX_Areas_PlaceId" ON "Areas" ("PlaceId");
CREATE INDEX "IX_BookingTemplates_AreaId" ON "BookingTemplates" ("AreaId");
CREATE INDEX "IX_BookingTemplates_GroupId" ON "BookingTemplates" ("GroupId");
CREATE INDEX "IX_BookingTemplates_ScheduleTemplateId_DayOfWeek_StartMin" ON "BookingTemplates" ("ScheduleTemplateId", "DayOfWeek", "StartMin");
CREATE INDEX "IX_Leafs_PlaceId" ON "Leafs" ("PlaceId");
CREATE INDEX "IX_ScheduleTemplates_PlaceId" ON "ScheduleTemplates" ("PlaceId");
CREATE INDEX "IX_Bookings_AreaId" ON "Bookings" ("AreaId");
CREATE INDEX "IX_Bookings_GroupId" ON "Bookings" ("GroupId");
CREATE INDEX "IX_CalendarBookings_AreaId" ON "CalendarBookings" ("AreaId");
CREATE INDEX "IX_CalendarBookings_GroupId" ON "CalendarBookings" ("GroupId");
CREATE INDEX "IX_CalendarBookings_SourceTemplateId" ON "CalendarBookings" ("SourceTemplateId");

-- Insert data
INSERT INTO Groups VALUES('274246B2-A966-4F5D-B961-98D1480A1F54','Dam A','#5F6B6D');
INSERT INTO Groups VALUES('340909EB-12B9-48C7-AE16-6D052BF84309','Herr A','#8C8C8C');
INSERT INTO Groups VALUES('3598E6DE-6D22-497E-B85A-9DBFAC78E5B0','P2012','#6E6E6E');
INSERT INTO Groups VALUES('4A209965-30D2-425A-909C-E488260618EF','F2010','#A3A3A3');
INSERT INTO Groups VALUES('6077886D-C213-439E-9197-B4A6973354DE','F2011','#9A9A9A');
INSERT INTO Groups VALUES('91A59DCC-79B7-4832-800D-71520F107746','Herr U','#B0B0B0');
INSERT INTO Groups VALUES('CEEAB321-F2AD-4FD4-AE8B-1348F96836FE','Dam B','#707D7E');
INSERT INTO Groups VALUES('E29566BD-628B-4534-8D07-62D498487259','F2012','#7D7D7D');

INSERT INTO Places VALUES('82C45ABE-1181-4BC4-9B3C-D773F74E7B2B','Bollstanäs IP 1',90,15,420,1260);
INSERT INTO Places VALUES('A5A6C5D1-228F-4133-8CF5-02E0978DB056','Bollstanäs IP 2',90,15,420,1260);
INSERT INTO Places VALUES('1B371E74-4E76-4946-B3EB-00D36990FE7D','Test',90,15,420,1260);

INSERT INTO Areas VALUES('92DB41A0-622F-478E-9DC6-1A05E44BAD3C','82C45ABE-1181-4BC4-9B3C-D773F74E7B2B','Helplan','NULL','/Helplan',100,50,25);
INSERT INTO Areas VALUES('545256DC-F068-472A-8FF0-F731E70648AD','82C45ABE-1181-4BC4-9B3C-D773F74E7B2B','Halvplan B','92DB41A0-622F-478E-9DC6-1A05E44BAD3C','/Helplan/Halvplan B',100,100,50);
INSERT INTO Areas VALUES('7BB5362D-743B-48A7-B6EF-69253B727590','82C45ABE-1181-4BC4-9B3C-D773F74E7B2B','Halvplan A','92DB41A0-622F-478E-9DC6-1A05E44BAD3C','/Helplan/Halvplan A',100,100,50);
INSERT INTO Areas VALUES('3CF95081-D881-4B4E-B33B-FBD1A865E37A','82C45ABE-1181-4BC4-9B3C-D773F74E7B2B','Kvartsplan A2','7BB5362D-743B-48A7-B6EF-69253B727590','/Helplan/Halvplan A/A2',100,100,100);
INSERT INTO Areas VALUES('6286B0F2-597F-49CA-BDC5-1509792BDEE8','82C45ABE-1181-4BC4-9B3C-D773F74E7B2B','Kvartsplan B2','545256DC-F068-472A-8FF0-F731E70648AD','/Helplan/Halvplan B/B2',100,100,100);
INSERT INTO Areas VALUES('9ABE0FD2-7AFA-4FE3-B2E1-C93CD0A80513','82C45ABE-1181-4BC4-9B3C-D773F74E7B2B','Kvartsplan A1','7BB5362D-743B-48A7-B6EF-69253B727590','/Helplan/Halvplan A/A1',100,100,100);
INSERT INTO Areas VALUES('F8E6C709-CC25-42F3-AC22-70F47238B99A','82C45ABE-1181-4BC4-9B3C-D773F74E7B2B','Kvartsplan B1','545256DC-F068-472A-8FF0-F731E70648AD','/Helplan/Halvplan B/B1',100,100,100);
INSERT INTO Areas VALUES('6AE3A174-EC3A-46B3-A3CD-7F30FBB15FBA','A5A6C5D1-228F-4133-8CF5-02E0978DB056','Helplan','NULL','/Helplan',100,50,25);
INSERT INTO Areas VALUES('1DDF9366-06AE-41DC-A3C8-B3C8DAD3E714','A5A6C5D1-228F-4133-8CF5-02E0978DB056','Halvplan B','6AE3A174-EC3A-46B3-A3CD-7F30FBB15FBA','/Helplan/Halvplan B',100,100,50);
INSERT INTO Areas VALUES('21CD5146-8355-459D-A57A-674EA7CAEB44','A5A6C5D1-228F-4133-8CF5-02E0978DB056','Halvplan A','6AE3A174-EC3A-46B3-A3CD-7F30FBB15FBA','/Helplan/Halvplan A',100,100,50);
INSERT INTO Areas VALUES('0A8D00BD-02E1-4AC9-B80A-A9FECFACD55C','A5A6C5D1-228F-4133-8CF5-02E0978DB056','Kvartsplan B2','1DDF9366-06AE-41DC-A3C8-B3C8DAD3E714','/Helplan/Halvplan B/Kvartsplan B2',100,100,100);
INSERT INTO Areas VALUES('1EF68E90-01B3-4E01-93C4-A4F7EF751976','A5A6C5D1-228F-4133-8CF5-02E0978DB056','Kvartsplan B1','1DDF9366-06AE-41DC-A3C8-B3C8DAD3E714','/Helplan/Halvplan B/Kvartsplan B1',100,100,100);
INSERT INTO Areas VALUES('B86B60AF-0B58-4F70-ABA9-05E292798B68','A5A6C5D1-228F-4133-8CF5-02E0978DB056','Kvartsplan A2','21CD5146-8355-459D-A57A-674EA7CAEB44','/Helplan/Halvplan A/Kvartsplan A2',100,100,100);
INSERT INTO Areas VALUES('C0FD079D-12D4-4440-A4D1-78A5F36EE3B1','A5A6C5D1-228F-4133-8CF5-02E0978DB056','Kvartsplan A1','21CD5146-8355-459D-A57A-674EA7CAEB44','/Helplan/Halvplan A/Kvartsplan A1',100,100,100);
INSERT INTO Areas VALUES('6772BC0B-7527-4554-99EE-11933B8B69C3','1B371E74-4E76-4946-B3EB-00D36990FE7D','Helplan','NULL','/Helplan',100,50,25);
INSERT INTO Areas VALUES('D3499F48-CDF1-4FA5-82A2-F041721424F8','1B371E74-4E76-4946-B3EB-00D36990FE7D','Halvplan B','6772BC0B-7527-4554-99EE-11933B8B69C3','/Helplan/Halvplan B',100,100,50);
INSERT INTO Areas VALUES('DE51835D-6D25-4412-B4B5-29AF960E2441','1B371E74-4E76-4946-B3EB-00D36990FE7D','Halvplan A','6772BC0B-7527-4554-99EE-11933B8B69C3','/Helplan/Halvplan A',100,100,50);
INSERT INTO Areas VALUES('1BDD5BEA-CA91-4D1E-ACD9-42C04395A6C0','1B371E74-4E76-4946-B3EB-00D36990FE7D','A1','DE51835D-6D25-4412-B4B5-29AF960E2441','/Helplan/Halvplan A/A1',100,100,100);
INSERT INTO Areas VALUES('26A09C27-1898-4D0C-973B-A8F627B8EAB7','1B371E74-4E76-4946-B3EB-00D36990FE7D','A2','DE51835D-6D25-4412-B4B5-29AF960E2441','/Helplan/Halvplan A/A2',100,100,100);
INSERT INTO Areas VALUES('6CD7700F-5ED2-4868-B150-3D7A04C8292D','1B371E74-4E76-4946-B3EB-00D36990FE7D','B1','D3499F48-CDF1-4FA5-82A2-F041721424F8','/Helplan/Halvplan B/B1',100,100,100);
INSERT INTO Areas VALUES('B577185F-0B2C-4000-9740-4C771DD34FE2','1B371E74-4E76-4946-B3EB-00D36990FE7D','B2','D3499F48-CDF1-4FA5-82A2-F041721424F8','/Helplan/Halvplan B/B2',100,100,100);

INSERT INTO Leafs VALUES('2331BD30-53AC-4422-A147-5A00C35DB295','82C45ABE-1181-4BC4-9B3C-D773F74E7B2B','A2',2);
INSERT INTO Leafs VALUES('62B300DE-0202-462A-B462-AC281D3CE8FF','82C45ABE-1181-4BC4-9B3C-D773F74E7B2B','A1',1);
INSERT INTO Leafs VALUES('7402A614-3D3B-4975-B884-28F2D14713EE','82C45ABE-1181-4BC4-9B3C-D773F74E7B2B','B2',4);
INSERT INTO Leafs VALUES('781C1C40-2667-4A83-B214-166068E1EA22','82C45ABE-1181-4BC4-9B3C-D773F74E7B2B','B1',3);
INSERT INTO Leafs VALUES('2845F01E-05F5-4F9A-8F9B-6262CDFC7766','A5A6C5D1-228F-4133-8CF5-02E0978DB056','B2',4);
INSERT INTO Leafs VALUES('310FD3C1-578C-4B28-98F5-8D7E7984371F','A5A6C5D1-228F-4133-8CF5-02E0978DB056','B1',3);
INSERT INTO Leafs VALUES('65CF05DB-60A0-448D-8F3C-04048C92CE1B','A5A6C5D1-228F-4133-8CF5-02E0978DB056','A2',2);
INSERT INTO Leafs VALUES('C4AAA4F6-B5C8-434E-A4B2-924B1EDF411B','A5A6C5D1-228F-4133-8CF5-02E0978DB056','A1',1);
INSERT INTO Leafs VALUES('10430E2A-9674-43B7-AEC4-9328C541DE4C','1B371E74-4E76-4946-B3EB-00D36990FE7D','B1',3);
INSERT INTO Leafs VALUES('26163316-96C4-41BF-9A86-C98E68D29372','1B371E74-4E76-4946-B3EB-00D36990FE7D','A2',2);
INSERT INTO Leafs VALUES('6B082904-2BC9-44C8-A6C2-2383A704A79E','1B371E74-4E76-4946-B3EB-00D36990FE7D','A1',1);
INSERT INTO Leafs VALUES('9127FDC9-C1C1-4262-AAF8-E60961408B14','1B371E74-4E76-4946-B3EB-00D36990FE7D','B2',4);

-- AreaLeafs relationships
INSERT INTO AreaLeafs VALUES('92DB41A0-622F-478E-9DC6-1A05E44BAD3C','2331BD30-53AC-4422-A147-5A00C35DB295');
INSERT INTO AreaLeafs VALUES('92DB41A0-622F-478E-9DC6-1A05E44BAD3C','62B300DE-0202-462A-B462-AC281D3CE8FF');
INSERT INTO AreaLeafs VALUES('92DB41A0-622F-478E-9DC6-1A05E44BAD3C','7402A614-3D3B-4975-B884-28F2D14713EE');
INSERT INTO AreaLeafs VALUES('92DB41A0-622F-478E-9DC6-1A05E44BAD3C','781C1C40-2667-4A83-B214-166068E1EA22');
INSERT INTO AreaLeafs VALUES('545256DC-F068-472A-8FF0-F731E70648AD','7402A614-3D3B-4975-B884-28F2D14713EE');
INSERT INTO AreaLeafs VALUES('545256DC-F068-472A-8FF0-F731E70648AD','781C1C40-2667-4A83-B214-166068E1EA22');
INSERT INTO AreaLeafs VALUES('7BB5362D-743B-48A7-B6EF-69253B727590','2331BD30-53AC-4422-A147-5A00C35DB295');
INSERT INTO AreaLeafs VALUES('7BB5362D-743B-48A7-B6EF-69253B727590','62B300DE-0202-462A-B462-AC281D3CE8FF');
INSERT INTO AreaLeafs VALUES('3CF95081-D881-4B4E-B33B-FBD1A865E37A','2331BD30-53AC-4422-A147-5A00C35DB295');
INSERT INTO AreaLeafs VALUES('6286B0F2-597F-49CA-BDC5-1509792BDEE8','7402A614-3D3B-4975-B884-28F2D14713EE');
INSERT INTO AreaLeafs VALUES('9ABE0FD2-7AFA-4FE3-B2E1-C93CD0A80513','62B300DE-0202-462A-B462-AC281D3CE8FF');
INSERT INTO AreaLeafs VALUES('F8E6C709-CC25-42F3-AC22-70F47238B99A','781C1C40-2667-4A83-B214-166068E1EA22');
INSERT INTO AreaLeafs VALUES('6AE3A174-EC3A-46B3-A3CD-7F30FBB15FBA','2845F01E-05F5-4F9A-8F9B-6262CDFC7766');
INSERT INTO AreaLeafs VALUES('6AE3A174-EC3A-46B3-A3CD-7F30FBB15FBA','310FD3C1-578C-4B28-98F5-8D7E7984371F');
INSERT INTO AreaLeafs VALUES('6AE3A174-EC3A-46B3-A3CD-7F30FBB15FBA','65CF05DB-60A0-448D-8F3C-04048C92CE1B');
INSERT INTO AreaLeafs VALUES('6AE3A174-EC3A-46B3-A3CD-7F30FBB15FBA','C4AAA4F6-B5C8-434E-A4B2-924B1EDF411B');
INSERT INTO AreaLeafs VALUES('1DDF9366-06AE-41DC-A3C8-B3C8DAD3E714','2845F01E-05F5-4F9A-8F9B-6262CDFC7766');
INSERT INTO AreaLeafs VALUES('1DDF9366-06AE-41DC-A3C8-B3C8DAD3E714','310FD3C1-578C-4B28-98F5-8D7E7984371F');
INSERT INTO AreaLeafs VALUES('21CD5146-8355-459D-A57A-674EA7CAEB44','65CF05DB-60A0-448D-8F3C-04048C92CE1B');
INSERT INTO AreaLeafs VALUES('21CD5146-8355-459D-A57A-674EA7CAEB44','C4AAA4F6-B5C8-434E-A4B2-924B1EDF411B');
INSERT INTO AreaLeafs VALUES('0A8D00BD-02E1-4AC9-B80A-A9FECFACD55C','2845F01E-05F5-4F9A-8F9B-6262CDFC7766');
INSERT INTO AreaLeafs VALUES('1EF68E90-01B3-4E01-93C4-A4F7EF751976','310FD3C1-578C-4B28-98F5-8D7E7984371F');
INSERT INTO AreaLeafs VALUES('B86B60AF-0B58-4F70-ABA9-05E292798B68','65CF05DB-60A0-448D-8F3C-04048C92CE1B');
INSERT INTO AreaLeafs VALUES('C0FD079D-12D4-4440-A4D1-78A5F36EE3B1','C4AAA4F6-B5C8-434E-A4B2-924B1EDF411B');
INSERT INTO AreaLeafs VALUES('6772BC0B-7527-4554-99EE-11933B8B69C3','10430E2A-9674-43B7-AEC4-9328C541DE4C');
INSERT INTO AreaLeafs VALUES('6772BC0B-7527-4554-99EE-11933B8B69C3','26163316-96C4-41BF-9A86-C98E68D29372');
INSERT INTO AreaLeafs VALUES('6772BC0B-7527-4554-99EE-11933B8B69C3','6B082904-2BC9-44C8-A6C2-2383A704A79E');
INSERT INTO AreaLeafs VALUES('6772BC0B-7527-4554-99EE-11933B8B69C3','9127FDC9-C1C1-4262-AAF8-E60961408B14');
INSERT INTO AreaLeafs VALUES('D3499F48-CDF1-4FA5-82A2-F041721424F8','10430E2A-9674-43B7-AEC4-9328C541DE4C');
INSERT INTO AreaLeafs VALUES('D3499F48-CDF1-4FA5-82A2-F041721424F8','9127FDC9-C1C1-4262-AAF8-E60961408B14');
INSERT INTO AreaLeafs VALUES('DE51835D-6D25-4412-B4B5-29AF960E2441','26163316-96C4-41BF-9A86-C98E68D29372');
INSERT INTO AreaLeafs VALUES('DE51835D-6D25-4412-B4B5-29AF960E2441','6B082904-2BC9-44C8-A6C2-2383A704A79E');
INSERT INTO AreaLeafs VALUES('1BDD5BEA-CA91-4D1E-ACD9-42C04395A6C0','6B082904-2BC9-44C8-A6C2-2383A704A79E');
INSERT INTO AreaLeafs VALUES('26A09C27-1898-4D0C-973B-A8F627B8EAB7','26163316-96C4-41BF-9A86-C98E68D29372');
INSERT INTO AreaLeafs VALUES('6CD7700F-5ED2-4868-B150-3D7A04C8292D','10430E2A-9674-43B7-AEC4-9328C541DE4C');
INSERT INTO AreaLeafs VALUES('B577185F-0B2C-4000-9740-4C771DD34FE2','9127FDC9-C1C1-4262-AAF8-E60961408B14');
